import kotlinx.datetime.Instant;

CREATE TABLE IF NOT EXISTS EmailVerificationToken (
    verify_token VARCHAR(36) PRIMARY KEY NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    new_email TEXT UNIQUE NOT NULL,
    expiry_time DATETIME(6) AS Instant NOT NULL,

    FOREIGN KEY (user_id) REFERENCES User(id)
);

ALTER TABLE User ADD COLUMN email_verified BOOLEAN DEFAULT FALSE AFTER email;

UPDATE DbMeta SET db_version = 2;
