import dev.chara.tasks.backend.domain.model.TaskList.Color;
import dev.chara.tasks.backend.domain.model.TaskList.Icon;

ALTER TABLE TaskList
ADD COLUMN color TEXT AS Color,
ADD COLUMN icon TEXT AS Icon,
ADD COLUMN description TEXT;

DROP VIEW IF EXISTS Reminder;

CREATE VIEW IF NOT EXISTS Reminder AS
    SELECT DISTINCT u.id AS user_id, t.id AS task_id, l.title AS list_title, l.color AS list_color, l.icon AS list_icon, t.label AS task_label, t.reminder_date, t.reminder_fired
    FROM User u, Task t, TaskList l
    WHERE u.id = t.user_id
    AND t.list_id = l.id
    AND t.is_completed = FALSE
    AND t.reminder_date <= UTC_TIMESTAMP()
    AND (
        t.reminder_fired IS NULL
        OR t.reminder_fired <= t.last_modified
    );

UPDATE DbMeta
SET db_version = 5;